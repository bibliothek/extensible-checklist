---
phase: 03-template-system
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - app/templates/page.tsx
  - app/templates/new/page.tsx
  - app/templates/[id]/edit/page.tsx
  - app/components/TemplateForm.tsx
autonomous: true

must_haves:
  truths:
    - "User can see list of all their templates"
    - "User can click to create new template"
    - "User can add multiple items to template using Enter key or button"
    - "User can edit existing template name and items"
    - "User can reorder items within template"
    - "User can delete template from library"
  artifacts:
    - path: "app/templates/page.tsx"
      provides: "Template library list view"
      min_lines: 50
    - path: "app/templates/new/page.tsx"
      provides: "Template creation page"
      min_lines: 30
    - path: "app/templates/[id]/edit/page.tsx"
      provides: "Template editing page"
      min_lines: 30
    - path: "app/components/TemplateForm.tsx"
      provides: "Reusable form for create and edit"
      min_lines: 80
  key_links:
    - from: "app/templates/page.tsx"
      to: "/api/templates"
      via: "fetch GET on mount"
      pattern: "fetch.*api/templates"
    - from: "app/components/TemplateForm.tsx"
      to: "/api/templates"
      via: "POST on create, PUT on edit"
      pattern: "fetch.*api/templates.*POST|PUT"
    - from: "app/templates/page.tsx"
      to: "app/templates/new/page.tsx"
      via: "navigation link"
      pattern: "Link.*templates/new"
---

<objective>
Build the template library UI that allows users to view, create, edit, reorder, and delete templates with multiple checklist items.

Purpose: Deliver the complete template management experience as specified in requirements TMPL-01 through TMPL-04
Output: Working template library with full CRUD capabilities and keyboard + mouse interaction support
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-template-system/03-template-system-CONTEXT.md

# Prior plan in this phase
@.planning/phases/03-template-system/03-01-SUMMARY.md

# Key files
@app/layout.tsx
@app/page.tsx
@app/login/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create template library list page</name>
  <files>app/templates/page.tsx</files>
  <action>
Create the template library page at /templates that displays all user templates.

**Structure:**
- Server component that fetches templates from /api/templates
- Display list of templates with name and item count
- Each template shows: name, "X items", created date
- "Create New Template" button/link to /templates/new
- Each template row has: "Edit" link to /templates/[id]/edit, "Delete" button
- Empty state when no templates: "No templates yet. Create your first template to get started."

**Delete functionality:**
- Delete button triggers client-side confirmation dialog
- On confirm, DELETE fetch to /api/templates/[id]
- On success, refresh page or optimistically remove from list

**Styling:**
- Use Tailwind CSS for layout (grid or list)
- Responsive design (stack on mobile, grid on desktop)
- Hover states on template cards
- Follow established patterns from login/signup pages

**Authentication:**
- Page should be protected (redirect to /login if not authenticated)
- Use getServerSession to check auth before rendering
  </action>
  <verify>
Visit http://localhost:3000/templates, confirm:
- Page loads and shows empty state when no templates exist
- Can navigate to create new template
- After creating template, it appears in list
- Edit and delete buttons are visible and functional
  </verify>
  <done>
Template library page exists, displays all user templates, provides navigation to create/edit, and handles delete with confirmation. Empty state shows when no templates exist.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create template form component and pages</name>
  <files>
app/components/TemplateForm.tsx
app/templates/new/page.tsx
app/templates/[id]/edit/page.tsx
  </files>
  <action>
Create a reusable TemplateForm component and pages for creating and editing templates.

**TemplateForm component (app/components/TemplateForm.tsx):**
- Props: initialData (optional), onSubmit, onCancel
- State: template name (string), items array [{id, text, order}]
- Template name input field
- Items list with inputs for each item
- "Add Item" button and Enter key both add new item (keyboard accessibility requirement from CONTEXT.md)
- Reordering mechanism (choose between drag-and-drop or up/down arrow buttons - your discretion)
- Remove item button for each item (X icon or "Remove" text)
- Save and Cancel buttons
- Client-side validation: name required, at least one item required
- Loading state during submission

**Create page (app/templates/new/page.tsx):**
- Protected route (auth check)
- Renders TemplateForm with no initialData
- onSubmit: POST to /api/templates with {name, items: [{text, order}]}
- On success: redirect to /templates
- On error: display error message

**Edit page (app/templates/[id]/edit/page.tsx):**
- Protected route (auth check)
- Server component fetches template data from /api/templates/[id]
- Renders TemplateForm with initialData from fetched template
- onSubmit: PUT to /api/templates/[id] with updated data
- On success: redirect to /templates
- On error: display error message

**Reordering implementation note:**
Items must maintain order field (0, 1, 2...). When user reorders, update order values before submit. Choose UI mechanism (drag handles with react-dnd or dnd-kit, OR simple up/down arrow buttons - arrow buttons are simpler and don't require external library).
  </action>
  <verify>
Test template creation flow:
1. Visit /templates/new
2. Enter template name "Morning Routine"
3. Add items using Enter key: "Wake up", "Exercise", "Shower"
4. Add item using button: "Breakfast"
5. Reorder items (test reordering mechanism)
6. Remove one item
7. Click Save
8. Confirm redirect to /templates and new template appears

Test template editing flow:
1. Click Edit on existing template
2. Change name and add/remove items
3. Save and verify changes persist
  </verify>
  <done>
Template creation and editing pages exist with reusable form component. Form supports both keyboard (Enter) and mouse (button) for adding items. Reordering works via chosen mechanism. Validation prevents empty templates. Save/cancel flow works correctly.
  </done>
</task>

</tasks>

<verification>
1. Template library page loads and displays templates
2. Create new template flow works end-to-end
3. Edit existing template flow works end-to-end
4. Delete template removes it from database and UI
5. Both Enter key and "Add Item" button work for adding items
6. Item reordering mechanism functions correctly
7. Empty states display appropriate messages
</verification>

<success_criteria>
- User can view all templates in library (TMPL-04)
- User can create new template with multiple items (TMPL-01)
- User can edit existing template - change name, add/remove/reorder items (TMPL-02)
- User can delete template from library (TMPL-03)
- Both Enter key and button work for adding items (per CONTEXT.md requirement)
- UI is responsive and follows established styling patterns
- All pages require authentication
</success_criteria>

<output>
After completion, create `.planning/phases/03-template-system/03-02-SUMMARY.md`
</output>
