---
phase: 04-checklist-workflow
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - app/checklists/[id]/page.tsx
autonomous: true

must_haves:
  truths:
    - "User can open a checklist to work on it"
    - "User can check off completed items"
    - "User can uncheck items if needed"
    - "User can add new items to active checklist"
    - "User can remove items from active checklist"
    - "User can reorder items in active checklist"
    - "Items are grouped by source template"
    - "Groups can be collapsed and expanded"
    - "Overall progress is displayed with visual progress bar"
  artifacts:
    - path: "app/checklists/[id]/page.tsx"
      provides: "Complete checklist working view with all interactions"
      min_lines: 300
      contains: "useState"
  key_links:
    - from: "app/checklists/[id]/page.tsx"
      to: "/api/checklists/[id]/items"
      via: "fetch calls for PATCH/POST/DELETE/PUT"
      pattern: "fetch.*api/checklists.*items"
    - from: "checkbox onChange"
      to: "PATCH /api/checklists/[id]/items"
      via: "completion toggle"
      pattern: "onChange.*completed"
    - from: "add item form"
      to: "POST /api/checklists/[id]/items"
      via: "form submission"
      pattern: "onSubmit.*text"
---

<objective>
Build full-featured checklist working page where users can complete, edit, and manage all aspects of an active checklist with grouped display and progress tracking.

Purpose: Core work experience - this is where users actually use their checklists day-to-day
Output: Complete checklist detail page with check/uncheck, add/remove/reorder items, collapsible template groups, and progress visualization
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-checklist-workflow/04-CONTEXT.md
@prisma/schema.prisma
@.planning/phases/04-checklist-workflow/04-01-SUMMARY.md
@.planning/phases/03-template-system/03-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create checklist working page with full interaction capabilities</name>
  <files>
    app/checklists/[id]/page.tsx
  </files>
  <action>
Create comprehensive checklist detail page at app/checklists/[id]/page.tsx with these features:

**Page Structure and Data Loading:**
- Client component using useSession for auth
- Redirect to /login if not authenticated
- Await params in Next.js 15: `const { id } = await params`
- Fetch checklist with items from GET /api/checklists on mount, filter by id
- Alternative: Create GET /api/checklists/[id] endpoint if cleaner (your discretion)
- Handle loading, error, and not-found states
- Dark mode compatible styling

**Progress Display (Top of Page):**
- Checklist name as h1
- Overall progress: "X of Y items completed"
- Visual progress bar showing completion percentage
- Tailwind classes for responsive progress bar (bg gradient, rounded, animated transition)
- Back link to /checklists

**Items Grouped by Source Template:**
- Group items by `sourceTemplate` field
- Each group has:
  - Template name as section header (h2 or h3)
  - Collapse/expand toggle button (▼/▶ icon or text)
  - State: `const [collapsed, setCollapsed] = useState<Record<string, boolean>>({})`
  - All groups expanded by default
- Within each group, items displayed in order

**Item Display and Interactions:**
Each item row contains:
- **Checkbox:**
  - Checked state from `item.completed`
  - onChange: PATCH /api/checklists/[id]/items with { itemId, completed: !current }
  - Optimistic UI update (toggle immediately, revert on error)
- **Item text:**
  - Inline editable text input (not just static text)
  - onBlur: save changes (PUT endpoint or PATCH - your discretion on implementation)
  - Follows pattern from template item editing
- **Reorder buttons:**
  - Up/down arrow buttons (↑ ↓) following template reordering pattern
  - Swap order values with adjacent item
  - PUT /api/checklists/[id]/items with order updates
  - Optimistic UI reorder
- **Delete button:**
  - X or trash icon
  - DELETE /api/checklists/[id]/items with { itemId }
  - Browser confirm for safety
  - Optimistic UI removal

**Add New Item Form:**
- Text input + "Add Item" button at bottom of checklist
- Enter key or button click to submit
- POST /api/checklists/[id]/items with { text }
- New items get sourceTemplate: "Custom" (not from any template)
- Optimistic UI append
- Clear input after successful add

**State Management:**
- Local state for checklist and items
- Optimistic updates for all operations
- Error handling with toast/alert or inline messages (your discretion)
- Re-fetch on mount, keep in sync with optimistic updates

**Responsive Design:**
- Mobile-friendly: stack elements vertically on small screens
- Touch-friendly button sizes
- Checkbox and buttons appropriately sized
- Follow Tailwind patterns from templates pages

Follow patterns from:
- app/templates/[id]/edit/page.tsx for inline editing
- app/templates/page.tsx for delete confirmations
- app/checklists/new/page.tsx for form handling
  </action>
  <verify>
- Visit http://localhost:3000/checklists/[actual-id]
- Page loads without errors
- Checklist name and progress display at top
- Items grouped by source template with headers
- Click collapse/expand toggle - groups hide/show
- Check checkbox - item marked complete, progress updates
- Uncheck checkbox - item marked incomplete, progress updates
- Edit item text inline - changes save on blur
- Click up/down arrows - items reorder within group
- Click delete button - item removed with confirmation
- Type in "Add Item" field, press Enter or click button - new item appears
- Verify optimistic updates feel instant
- Check browser console and terminal for errors
  </verify>
  <done>
- Checklist detail page exists at /checklists/[id] (CHKL-02)
- Protected route redirects unauthenticated users
- Overall progress displayed with visual bar at top
- Items grouped by sourceTemplate with collapsible sections
- User can check/uncheck items via checkbox (CHKL-03, CHKL-04)
- User can add new items via form at bottom (CHKL-05)
- User can remove items with delete button (CHKL-06)
- User can reorder items with up/down buttons (CHKL-07)
- User can edit item text inline
- All interactions use optimistic UI updates
- Responsive layout works on mobile/tablet/desktop
- Dark mode styling consistent with app
- No TypeScript or runtime errors
  </done>
</task>

</tasks>

<verification>
1. Run development server: `npm run dev`
2. Log in and create a checklist from multiple templates at /checklists/new
3. Navigate to /checklists and click the checklist name
4. Verify checklist detail page opens with all items grouped by template
5. Test completion: check and uncheck items, verify progress updates
6. Test reordering: move items up and down within groups
7. Test editing: click item text, edit, blur - verify changes save
8. Test deletion: delete an item, confirm it's removed
9. Test adding: add new item via form, verify it appears
10. Test collapsing: collapse/expand template groups
11. Verify optimistic updates feel responsive (no waiting for API)
12. Test on mobile viewport for responsive design
</verification>

<success_criteria>
**Measurable outcomes:**
- User can open checklist and see all items grouped by template (CHKL-02)
- User can check off completed items with immediate feedback (CHKL-03)
- User can uncheck items if needed (CHKL-04)
- User can add new items to active checklist (CHKL-05)
- User can remove items from checklist (CHKL-06)
- User can reorder items in checklist (CHKL-07)
- Template groups are collapsible/expandable
- Overall progress is displayed with visual progress bar
- All interactions work smoothly with optimistic UI
- No errors in console or terminal
</success_criteria>

<output>
After completion, create `.planning/phases/04-checklist-workflow/04-02-SUMMARY.md`
</output>
