---
phase: 04-checklist-workflow
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/api/checklists/route.ts
  - app/api/checklists/[id]/route.ts
  - app/api/checklists/[id]/items/route.ts
  - app/checklists/page.tsx
autonomous: true

must_haves:
  truths:
    - "User can view list of all their active checklists"
    - "Each checklist shows name and progress indicator"
    - "User can delete a checklist from the list"
    - "Empty state appears when user has no checklists"
  artifacts:
    - path: "app/api/checklists/route.ts"
      provides: "GET endpoint for checklist list"
      exports: ["GET"]
    - path: "app/api/checklists/[id]/route.ts"
      provides: "DELETE endpoint for checklist removal"
      exports: ["DELETE"]
    - path: "app/api/checklists/[id]/items/route.ts"
      provides: "Item update endpoints for completion, add, remove, reorder"
      exports: ["PATCH", "POST", "DELETE", "PUT"]
    - path: "app/checklists/page.tsx"
      provides: "Checklist list view with progress"
      min_lines: 100
  key_links:
    - from: "app/checklists/page.tsx"
      to: "/api/checklists"
      via: "fetch in useEffect"
      pattern: "fetch.*api/checklists"
    - from: "app/api/checklists/route.ts"
      to: "prisma.checklist"
      via: "database query with item count"
      pattern: "prisma\\.checklist\\.findMany"
---

<objective>
Build checklist management API and list view page to enable users to see all active checklists with progress indicators and delete completed checklists.

Purpose: Provides entry point for checklist workflow and API foundation for all checklist operations (completion, editing, deletion)
Output: Working checklist list page with progress calculation and full CRUD API for checklist/item operations
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-checklist-workflow/04-CONTEXT.md
@prisma/schema.prisma
@.planning/phases/03-template-system/03-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create checklist management API endpoints</name>
  <files>
    app/api/checklists/route.ts
    app/api/checklists/[id]/route.ts
    app/api/checklists/[id]/items/route.ts
  </files>
  <action>
Create three API route files for complete checklist and item management:

**app/api/checklists/route.ts:**
- GET endpoint to fetch all user's checklists
- Requires authentication (return 401 if no session)
- Query: `prisma.checklist.findMany({ where: { userId }, include: { items: true }, orderBy: { createdAt: 'desc' } })`
- Response includes checklist with items array for progress calculation
- Use Next.js 15 async params pattern (await params)

**app/api/checklists/[id]/route.ts:**
- DELETE endpoint to remove a checklist
- Requires authentication (401 if no session)
- Await params: `const { id } = await params`
- Verify ownership: fetch checklist, check userId matches session.user.id (404 if not found, 403 if not owner)
- Use `prisma.checklist.delete({ where: { id } })` (items cascade-deleted automatically)
- Return 200 with success message

**app/api/checklists/[id]/items/route.ts:**
- POST endpoint: Add new item to checklist
  - Body: `{ text: string }`
  - Get max order from existing items, add with order = max + 1
  - Return 201 with created item
- PATCH endpoint: Toggle item completion
  - Body: `{ itemId: string, completed: boolean }`
  - Update item: `prisma.checklistItem.update({ where: { id: itemId }, data: { completed } })`
  - Verify item belongs to user's checklist (join through checklist.userId)
  - Return 200 with updated item
- DELETE endpoint: Remove item from checklist
  - Body: `{ itemId: string }`
  - Verify ownership through checklist relation
  - Delete: `prisma.checklistItem.delete({ where: { id: itemId } })`
  - Return 200
- PUT endpoint: Reorder items
  - Body: `{ updates: Array<{ itemId: string, order: number }> }`
  - Use transaction to update all order values atomically
  - Verify all items belong to user's checklist
  - Return 200

Follow established patterns from template API routes: auth checks, error handling, TypeScript types, user isolation.
  </action>
  <verify>
- Run `npm run dev` (no TypeScript errors)
- Test GET /api/checklists returns 401 when not authenticated
- Test DELETE returns proper status codes
- Verify all endpoints accessible with curl or browser dev tools
  </verify>
  <done>
- GET /api/checklists endpoint exists and returns user's checklists with items
- DELETE /api/checklists/[id] endpoint exists with ownership verification
- POST/PATCH/DELETE/PUT /api/checklists/[id]/items endpoints exist for item operations
- All endpoints enforce authentication and user isolation
- TypeScript compiles without errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Build checklist list page with progress indicators</name>
  <files>
    app/checklists/page.tsx
  </files>
  <action>
Create checklist list page at app/checklists/page.tsx following these specs:

**Layout and Authentication:**
- Client component with useSession for auth
- Redirect to /login if not authenticated
- Fetch all checklists from GET /api/checklists on mount
- Dark mode compatible styling (follow template page patterns)

**List Display:**
- Responsive grid: 1 column mobile, 2 tablet, 3 desktop
- Sort by createdAt descending (newest first) - comes from API
- Each card shows:
  - Checklist name (h3 heading, clickable link to /checklists/[id])
  - Progress indicator: "X/Y items completed" calculated from items array
  - Visual progress bar (Tailwind width percentage based on completion)
  - Created date (formatted locale date)
  - Delete button (browser confirm, optimistic UI removal, DELETE to API)

**Progress Calculation:**
```typescript
const completedCount = checklist.items.filter(item => item.completed).length
const totalCount = checklist.items.length
const percentage = totalCount > 0 ? (completedCount / totalCount) * 100 : 0
```

**Empty State:**
- Show when checklists array is empty
- Message: "No active checklists yet"
- Button: "Create from Templates" linking to /checklists/new

**Error Handling:**
- Loading state while fetching
- Error message if API fetch fails
- Proper TypeScript types for checklist and item data

Follow UI patterns from app/templates/page.tsx: card grid, delete with confirm, responsive layout, Tailwind classes.
  </action>
  <verify>
- Visit http://localhost:3000/checklists
- Page loads without errors (check browser console and terminal)
- Redirects to login if not authenticated
- Shows empty state when no checklists exist
- If checklists exist (create via /checklists/new), they appear with progress indicators
  </verify>
  <done>
- Checklist list page exists at /checklists
- Protected route redirects unauthenticated users
- Displays all user checklists sorted by most recent
- Progress indicator shows X/Y items completed
- Visual progress bar displays completion percentage
- Delete button removes checklist with confirmation
- Empty state with link to create new checklist
- Responsive layout works on mobile/tablet/desktop
- Dark mode styling consistent with rest of app
  </done>
</task>

</tasks>

<verification>
1. Run development server: `npm run dev`
2. Log in to application
3. Visit /checklists page
4. Verify empty state if no checklists
5. Create checklist via /checklists/new
6. Return to /checklists, verify it appears with progress 0/N items
7. Click checklist name to open (will 404 until Plan 02 - expected)
8. Test delete button removes checklist from list
9. Verify API endpoints return proper status codes with curl/browser tools
</verification>

<success_criteria>
**Measurable outcomes:**
- User can view all active checklists at /checklists (CHKL-01)
- Each checklist displays name and progress indicator
- Progress shows completed/total item count
- User can delete checklist from list (CHKL-08)
- Empty state guides user to create first checklist
- All API endpoints functional and secured
- No TypeScript or runtime errors
</success_criteria>

<output>
After completion, create `.planning/phases/04-checklist-workflow/04-01-SUMMARY.md`
</output>
