---
phase: 02-authentication
plan: 03
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - app/login/page.tsx
  - app/components/LogoutButton.tsx
  - app/page.tsx
autonomous: true

must_haves:
  truths:
    - "User can access login page at /login"
    - "User can submit existing email and password to sign in"
    - "Invalid credentials show 'Invalid email or password' error"
    - "Successful login redirects to authenticated area"
    - "User can log out from any page"
    - "Logout clears session and redirects to login or landing"
  artifacts:
    - path: "app/login/page.tsx"
      provides: "Login form UI with email/password inputs"
      min_lines: 40
    - path: "app/components/LogoutButton.tsx"
      provides: "Reusable logout button component"
      exports: ["default"]
  key_links:
    - from: "app/login/page.tsx"
      to: "signIn from next-auth/react"
      via: "credentials authentication"
      pattern: "signIn\\(['\"]credentials['\"]"
    - from: "app/components/LogoutButton.tsx"
      to: "signOut from next-auth/react"
      via: "session termination"
      pattern: "signOut\\("
---

<objective>
Enable existing users to log in with credentials and log out from authenticated areas.

Purpose: Implement login flow with client-side form, Auth.js credentials sign-in, error handling, and logout functionality per requirements (AUTH-02, AUTH-03).

Output: Working login page at /login with error messages for invalid credentials, logout button component for use across app, proper session handling per CONTEXT.md (30-day sessions, sliding window).
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-authentication/02-CONTEXT.md

# Auth foundation
@.planning/phases/02-authentication/02-01-SUMMARY.md

# Existing auth config
@auth.ts
@prisma/schema.prisma
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Login Page</name>
  <files>app/login/page.tsx, app/page.tsx</files>
  <action>
Create login flow allowing existing users to authenticate:

1. **Create `app/login/page.tsx`:**
   - Client component ("use client")
   - Form with two inputs:
     - Email input (type="email", required)
     - Password input (type="password", required)
   - Submit button labeled "Log In"
   - On submit: call `signIn("credentials", { email, password, redirect: false })`
   - Import signIn from "next-auth/react"
   - Handle response:
     - Success (ok: true): redirect to "/" (or dashboard if exists)
     - Error (ok: false): show "Invalid email or password" message (per CONTEXT.md requirements)
   - Use Tailwind CSS styling consistent with signup page
   - Include link to /signup for new users

2. **Update landing page `app/page.tsx`:**
   - Add link to /login alongside existing /signup link
   - Simple "Log In" button or text link

Per CONTEXT.md: separate /login and /signup pages (not tabbed interface), simple error message for failed login.
  </action>
  <verify>
Run `npm run build` to confirm TypeScript compilation.
Visit http://localhost:3000/login - form renders correctly.
Try logging in with non-existent credentials - shows "Invalid email or password" error.
Create user via /signup, then login with those credentials - successfully authenticates.
Check browser DevTools Application > Cookies - session cookie present after successful login.
  </verify>
  <done>
Login page exists at /login with email and password form. Form calls Auth.js signIn with credentials provider. Invalid credentials show "Invalid email or password" error. Successful login creates session and redirects to authenticated area. Landing page links to /login.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Logout Functionality</name>
  <files>app/components/LogoutButton.tsx, app/page.tsx</files>
  <action>
Create logout functionality accessible from authenticated areas:

1. **Create `app/components/LogoutButton.tsx`:**
   - Client component ("use client")
   - Import signOut from "next-auth/react"
   - Button that calls `signOut({ callbackUrl: "/" })` on click
   - Styled with Tailwind CSS
   - Label: "Log Out" or "Sign Out"

2. **Add logout button to landing page (temporary for testing):**
   - Import LogoutButton component in app/page.tsx
   - Conditionally render based on session state:
     - Use `useSession()` hook from "next-auth/react"
     - If authenticated: show LogoutButton
     - If not authenticated: show Login/Signup links
   - Wrap app with SessionProvider:
     - Update app/layout.tsx to import SessionProvider from "next-auth/react"
     - Wrap {children} with <SessionProvider>

Per CONTEXT.md: logout available from any page, no specified UI placement (Claude's discretion). For v1, logout button in header or user menu is standard pattern.

Note: In future plans, LogoutButton can be added to a proper header/nav component. For now, landing page demonstrates functionality.
  </action>
  <verify>
Log in via /login page.
Visit landing page - LogoutButton visible (user is authenticated).
Click logout button - redirects to landing page.
Check browser DevTools Application > Cookies - session cookie cleared.
Try accessing a future protected route - should redirect to login (will verify in Plan 04).
  </verify>
  <done>
LogoutButton component created and functional. Clicking logout terminates session via Auth.js signOut, clears session cookie, and redirects to landing page. Landing page shows conditional UI: logout button when authenticated, login/signup links when not. SessionProvider wraps app in layout.tsx. AUTH-03 requirement satisfied.
  </done>
</task>

</tasks>

<verification>
After completing both tasks:
1. /login page renders with email and password form
2. Invalid credentials show "Invalid email or password" error
3. Valid credentials create session and authenticate user
4. Session cookie persists in browser
5. LogoutButton component exists and works
6. Clicking logout clears session and redirects
7. Landing page shows context-appropriate UI (login/signup vs logout)
</verification>

<success_criteria>
Login and logout complete when:
- User can navigate to /login from landing page
- User can authenticate with valid email/password credentials
- Invalid credentials show clear error message (no detail leakage)
- Successful login creates 30-day session with sliding window (configured in 02-01)
- Logout button component available for use in app
- Logout terminates session and redirects appropriately
- AUTH-02 requirement satisfied (user can log in and stay logged in)
- AUTH-03 requirement satisfied (user can log out)
</success_criteria>

<output>
After completion, create `.planning/phases/02-authentication/02-03-SUMMARY.md`
</output>
