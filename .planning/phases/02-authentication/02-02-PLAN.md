---
phase: 02-authentication
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - app/signup/page.tsx
  - app/api/auth/signup/route.ts
autonomous: true

must_haves:
  truths:
    - "User can access signup page at /signup"
    - "User can submit email and password to create account"
    - "Password is hashed before storing in database"
    - "Duplicate email shows clear error message"
    - "Successful signup redirects to authenticated area"
  artifacts:
    - path: "app/signup/page.tsx"
      provides: "Signup form UI with email/password inputs"
      min_lines: 40
    - path: "app/api/auth/signup/route.ts"
      provides: "API endpoint to create user with hashed password"
      exports: ["POST"]
  key_links:
    - from: "app/signup/page.tsx"
      to: "/api/auth/signup"
      via: "form submission POST request"
      pattern: "fetch.*['\"].*signup['\"]"
    - from: "app/api/auth/signup/route.ts"
      to: "bcrypt.hash"
      via: "password hashing before database insert"
      pattern: "bcrypt\\.hash\\("
    - from: "app/api/auth/signup/route.ts"
      to: "prisma.user.create"
      via: "database insert with hashed password"
      pattern: "prisma\\.user\\.create\\("
---

<objective>
Enable new users to create accounts with email and password.

Purpose: Implement signup flow with client-side form, API endpoint for user creation, password hashing, and duplicate email handling per requirements (AUTH-01).

Output: Working signup page at /signup with form validation, API route that hashes passwords and creates users, clear error messages for duplicate emails.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-authentication/02-CONTEXT.md

# Auth foundation
@.planning/phases/02-authentication/02-01-SUMMARY.md

# Existing auth config
@auth.ts
@prisma/schema.prisma
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Signup Page and API</name>
  <files>app/signup/page.tsx, app/api/auth/signup/route.ts</files>
  <action>
Create signup flow allowing users to register with email and password:

1. **Create `app/signup/page.tsx`:**
   - Client component ("use client")
   - Form with two inputs:
     - Email input (type="email", required)
     - Password input (type="password", required, minLength=8)
   - Submit button
   - Client-side validation: email format, password minimum 8 characters (per CONTEXT.md requirements)
   - On submit: POST to /api/auth/signup with { email, password }
   - Handle response:
     - Success: Sign in via Auth.js signIn("credentials", { email, password, callbackUrl: "/" })
     - Error 409: Show "Email already registered - try logging in instead"
     - Other errors: Show "Something went wrong"
   - Use Tailwind CSS for styling (consistent with existing app/page.tsx)
   - Include link to /login for existing users

2. **Create `app/api/auth/signup/route.ts`:**
   - Export async POST function
   - Accept { email, password } from request body
   - Validate inputs:
     - Email present and valid format
     - Password present and >= 8 characters
   - Hash password: `bcrypt.hash(password, 10)`
   - Create user: `db.user.create({ data: { email, password: hashedPassword } })`
   - Handle errors:
     - Prisma unique constraint violation (P2002): return 409 Conflict with message "Email already registered"
     - Other errors: return 500
   - Success: return 201 with { id, email } (don't send password hash back)

3. **Add /signup link to landing page:**
   - Update app/page.tsx to include link to /signup (and /login)
   - Simple "Get Started" or "Sign Up" button

Follow existing project patterns:
- Import db from "@/lib/db" for database operations
- Use bcryptjs (already installed in 02-01)
- Match Tailwind styling from existing pages
  </action>
  <verify>
Run `npm run build` to confirm TypeScript compilation.
Visit http://localhost:3000/signup in browser - form renders correctly.
Submit form with test data - check Network tab for POST to /api/auth/signup.
Check Prisma Studio - User record created with hashed password (not plaintext).
Try same email twice - second attempt shows "Email already registered" error.
  </verify>
  <done>
Signup page exists at /signup with email and password inputs. Form submits to /api/auth/signup API route. API hashes password with bcrypt, creates User in database, handles duplicate email with 409 error. Successful signup redirects to authenticated area. Landing page links to /signup.
  </done>
</task>

</tasks>

<verification>
After completing task:
1. /signup page renders with email and password form
2. Form validates minimum password length (8 characters)
3. Submitting form creates User record in database
4. Password stored as bcrypt hash (not plaintext)
5. Duplicate email submission shows "Email already registered" error
6. Successful signup auto-signs in and redirects
7. Landing page has link to signup
</verification>

<success_criteria>
Signup complete when:
- User can navigate to /signup from landing page
- User can enter email and password (min 8 chars)
- Valid submission creates User in database with hashed password
- Duplicate email shows clear error message suggesting login
- Successful signup auto-authenticates and redirects user
- AUTH-01 requirement satisfied (user can create account)
</success_criteria>

<output>
After completion, create `.planning/phases/02-authentication/02-02-SUMMARY.md`
</output>
