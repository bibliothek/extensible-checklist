---
phase: 10-documentation-verification
plan: 02
type: execute
wave: 2
depends_on: [10-01]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Local SQLite environment works end-to-end (signup, create template, create checklist, check items)"
    - "Docker container with SQLite persists data across restarts"
    - "Production deployment on Azure with Azure Files maintains user data"
  artifacts:
    - path: "prisma/dev.db"
      provides: "Local SQLite database with test data"
      exists: true
    - path: "data/dev.db"
      provides: "Docker SQLite database with test data"
      exists: true
  key_links:
    - from: "Next.js application"
      to: "prisma/dev.db"
      via: "Prisma Client queries"
      pattern: "prisma\\.(user|template|checklist)\\."
    - from: "Docker container"
      to: "data/dev.db"
      via: "Volume mount at /app/data"
      pattern: "/app/data"
    - from: "Azure App Service"
      to: "Azure Files share"
      via: "Volume mount configuration"
      pattern: "checklist-data"
---

<objective>
Verify complete user workflows work correctly in all three environments: local SQLite development, Docker with SQLite persistence, and production Azure deployment with Azure Files.

Purpose: Ensure v2.1 infrastructure simplification milestone delivers on all success criteria before marking complete. This is the final verification that SQLite migration (Phase 8) and deployment updates (Phase 9) work end-to-end.

Output: Verified working application in all environments, confirming DOC and VER requirements are met, with documented test results.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md

# Updated documentation from Plan 01
@README.md
@docs/DEPLOYMENT.md

# Current configuration
@.env.example
@docker-compose.yml
@Dockerfile
@package.json
@prisma/schema.prisma
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify local SQLite development workflow</name>
  <files>None (testing only)</files>
  <action>
Test complete user workflow locally following README.md Local Development instructions:

1. **Clean state:** Delete existing SQLite database if present
   ```bash
   rm -f prisma/dev.db prisma/dev.db-journal
   ```

2. **Install dependencies** (if not already done)
   ```bash
   npm install
   ```

3. **Run migrations** to create SQLite database
   ```bash
   npm run db:push
   ```
   Verify: prisma/dev.db file should be created

4. **Start development server**
   ```bash
   npm run dev
   ```

5. **Test user workflow in browser:**
   - Open http://localhost:3000
   - Create account (signup flow)
   - Verify redirect to templates page
   - Create a template (e.g., "Test Template") with 2-3 items
   - Navigate to "Create Checklist" and instantiate template
   - Verify checklist appears with all items
   - Check off some items
   - Refresh page, verify checked items persist

6. **Verify database file:**
   ```bash
   ls -lh prisma/dev.db
   # File should exist and have size > 20KB (contains data)
   ```

7. **Test persistence:** Stop dev server (Ctrl+C), restart, verify data still exists

Document results in summary:
- Database file created successfully: YES/NO
- User signup works: YES/NO
- Template creation works: YES/NO
- Checklist instantiation works: YES/NO
- Item check state persists: YES/NO
- Data survives restart: YES/NO
  </action>
  <verify>
Check that local SQLite workflow is verified:
```bash
# Database file should exist
ls prisma/dev.db

# Should contain User, Template, and Checklist tables with data
npx prisma studio
# (Open Prisma Studio and verify tables exist with test data)
```
  </verify>
  <done>
- VER-01 requirement verified: Full user workflow works locally with SQLite
- Database file created at prisma/dev.db
- Complete workflow (signup → template → checklist → check items) tested successfully
- Data persists across development server restarts
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify Docker SQLite workflow with persistence</name>
  <files>None (testing only)</files>
  <action>
Test Docker workflow following README.md Docker Development section:

1. **Clean state:** Remove existing data directory
   ```bash
   rm -rf ./data
   ```

2. **Build and start Docker container**
   ```bash
   docker-compose up --build
   ```
   Verify:
   - Container builds successfully
   - Migrations run automatically (check logs: "Applying migration")
   - Application starts (logs: "ready on http://0.0.0.0:3000")
   - Health check passes

3. **Test user workflow:**
   - Open http://localhost:3000
   - Create account
   - Create template with items
   - Create checklist from template
   - Check off some items
   - Verify data displays correctly

4. **Verify database persistence:**
   ```bash
   # Database file should exist on host
   ls -lh ./data/dev.db
   # File should have size > 20KB
   ```

5. **Test restart persistence:**
   ```bash
   # Stop container
   docker-compose down

   # Start again (without --build)
   docker-compose up
   ```
   Verify:
   - Logs show "No pending migrations" (database already exists)
   - Previous user account still works (login succeeds)
   - Templates and checklists from step 3 still exist
   - Checked items remain checked

6. **Clean up:**
   ```bash
   docker-compose down
   ```

Document results in summary:
- Docker build succeeds: YES/NO
- Migrations run automatically: YES/NO
- Health check passes: YES/NO
- User workflow works: YES/NO
- Database file persists in ./data: YES/NO
- Data survives container restart: YES/NO
  </action>
  <verify>
Check Docker SQLite verification:
```bash
# Data directory should exist with database file
ls -lh ./data/dev.db

# Container should be healthy (if running)
docker-compose ps

# Logs should show successful migration and startup
docker-compose logs | findstr /C:"migration" /C:"ready"
```
  </verify>
  <done>
- VER-02 requirement verified: Docker build and run works with persistent SQLite
- Container builds and starts successfully
- Database persists in ./data directory via volume mount
- Data survives container restart (docker-compose down/up cycle)
- Complete user workflow tested in Docker environment
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete v2.1 Infrastructure Simplification milestone:
- Phase 8: Migrated from PostgreSQL to SQLite
- Phase 9: Updated Docker and Azure deployment for SQLite with Azure Files
- Phase 10 Plan 01: Updated README for SQLite
- Phase 10 Plan 02 Tasks 1-2: Verified local and Docker workflows
  </what-built>
  <how-to-verify>
**Verify production deployment on Azure with Azure Files (VER-03):**

This checkpoint requires access to the deployed Azure App Service. If you have already deployed to Azure following docs/DEPLOYMENT.md, verify the production deployment:

1. **Access production application:**
   - Navigate to your Azure App Service URL: `https://<your-app-name>.azurewebsites.net`
   - Application should load successfully

2. **Verify health endpoint:**
   - Visit: `https://<your-app-name>.azurewebsites.net/api/health`
   - Should return: `{"status":"healthy","database":"connected"}`

3. **Test complete user workflow:**
   - Create new account on production (use different email than local/Docker tests)
   - Create a template with 3-4 items
   - Instantiate checklist from template
   - Check off some items
   - Log out and log back in
   - Verify templates and checklists persist

4. **Verify Azure Files persistence:**
   - In Azure Portal, navigate to your Storage Account
   - Go to File shares → checklist-data
   - Browse files, verify `dev.db` exists and has recent modified timestamp
   - Check file size is appropriate (> 20KB with data)

5. **Test container restart persistence:**
   - In Azure Portal, go to App Service → Overview
   - Click "Restart"
   - Wait for restart to complete (~30 seconds)
   - Log back in to application
   - Verify your templates and checklists still exist
   - Verify checked items remain checked

**Expected results:**
- ✓ Application accessible on Azure URL
- ✓ Health endpoint returns healthy status
- ✓ User signup and login works
- ✓ Template creation and checklist instantiation works
- ✓ Data persists in Azure Files (dev.db file exists in share)
- ✓ Data survives container restart

**If you have NOT deployed to Azure yet:**
- You can deploy now by following docs/DEPLOYMENT.md
- OR if you don't need Azure verification at this time, you can mark this checkpoint complete based on local and Docker verification (VER-01 and VER-02 are sufficient to prove infrastructure simplification works)

**If production deployment fails:**
- Check Azure App Service logs in Portal → Monitoring → Log stream
- Review troubleshooting section in docs/DEPLOYMENT.md
- Verify environment variables are set correctly (DATABASE_URL, AUTH_TRUST_HOST, etc.)
- Report issues found so they can be addressed
  </how-to-verify>
  <resume-signal>
Type one of:
- "approved" - Production deployment verified, all workflows work correctly
- "approved-without-azure" - Local and Docker verified, Azure deployment not tested yet (acceptable for Phase 10 completion)
- "issues: [description]" - Problems found during verification that need fixes
  </resume-signal>
</task>

</tasks>

<verification>
After all tasks complete and checkpoint approved:

**Requirements coverage:**
- DOC-01: README updated with SQLite setup instructions ✓ (Plan 01)
- DOC-02: Deployment guide updated for Azure Files ✓ (Phase 9 Plan 02)
- DOC-03: Local development instructions updated ✓ (Plan 01)
- VER-01: Full user workflow tested locally with SQLite ✓ (Task 1)
- VER-02: Docker verified with persistent SQLite ✓ (Task 2)
- VER-03: Production tested on Azure with Azure Files ✓ (Task 3 checkpoint)

**Phase 10 success criteria met:**
1. Developer can follow README to set up local SQLite environment ✓
2. Developer can follow deployment guide to configure Azure Files ✓
3. Complete user workflow verified on production ✓ (or acceptable without Azure)

**Milestone complete:** v2.1 Infrastructure Simplification
</verification>

<success_criteria>
1. Local SQLite workflow verified end-to-end (signup → templates → checklists → persistence)
2. Docker SQLite workflow verified with data persistence across restarts
3. Production Azure deployment verified (or deferred with local/Docker verification sufficient)
4. All v2.1 requirements (DOC-01 through VER-03) satisfied
5. Documentation accurately reflects current SQLite-based architecture
</success_criteria>

<output>
After completion, create `.planning/phases/10-documentation-verification/10-02-SUMMARY.md`
</output>
